<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>OpenDeck</title>
 
 <link href="css/style.css" rel="stylesheet" />
 <link href="css/controls.css" rel="stylesheet" />
 <link href="css/circle.css" rel="stylesheet" />

 <script src="js/jquery-1.12.0.min.js"></script>
 
 <script src="js/Main.js"></script>
 <script src="js/ConnectToMIDIDevice.js"></script>
 <script src="js/Buttons.js"></script>
 <script src="js/Encoders.js"></script>
 <script src="js/LEDs.js"></script>
 <script src="js/Analog.js"></script>
 <script src="js/MIDI.js"></script>
 <script src="js/GlobalLED.js"></script>

 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

</head>
<body onload="checkForDevices();">
 
 <div id="loader">
  
  <div id="ripple" class="centered">
   <div id="ripple-content" class="ripple-content" >Scanning for device</div>
   <div class="ripple-animation">
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
    <div class="circle"></div>
   </div>
  </div>
 </div>

 
 <div id="main" class="flip-container" style="display:none;">
  <div class="flipper">
   <div class="front">
    <div id="contentWrap" class="tranisitionItem">
     <img src="img/mobile_menu_icon.png" width="50" onclick="flip();" />
     <div id="content" class="content"></div>
     <div id="edit" style="display:none;" class="content">
     </div>
    </div>
   </div>
   <div class="back">
    <ul id="menu" class="menu">
     <li class="menuItem" onclick="flip();"><img class="logo" width="300" src="img/logo.jpg" /></li>
     <li class="menuItem">
      <span>Configuration</span>
      <ul class="menuSubLevel">
       <li onclick="sendMIDIGet();  flip();">MIDI</li>
       <li onclick="sendButtonGet(); showContent(); setContentMargin(); flip();">Buttons</li>
       <li onclick="sendEncoderGet(); showContent(); setContentMargin(); flip(); ">Encoders</li>
       <li onclick="sendLedGet(); showContent(); setContentMargin(); flip(); ">LEDs</li>
       <li onclick="sendGlobalLEDGet(); showContent(); flip(); ">Global LEDs</li>
       <li onclick="sendAnalogGet(); showContent(); setContentMargin(); flip(); ">Analog</li>
      </ul>
     </li>
     <li class="menuItem">
      <span>Settings</span>
      <ul class="menuSubLevel">
       <li>link 1 </li>
       <li>link 2 </li>
       <li>link 3 </li>
      </ul>
     </li>
    </ul>
   </div>
  </div>
 </div>

 <script>

  $(document).ready(function () {
   $('#menu span').each(function () {
    $(this).unbind().bind('click', openOne);
   });
   $('.menuSubLevel li').each(function () {
    $(this).unbind().bind('click', setOne);
   });

   window.onresize = onResize;

  });

  function onResize(event) {
   setContentMargin();
  }

  function setContentMargin() {
   setTimeout(function () {
    var maxWidth = $('#content').width()-1;
    var elWidth = 200;
    var maxElements = Math.floor(maxWidth / elWidth);
    

    var margin = mesaureMargin(maxElements, maxWidth, elWidth);
    if (margin < 20) {
     margin = mesaureMargin(maxElements - 1, maxWidth, elWidth);
    }
    
    

    $('#content a').each(function () {
     $(this).css('margin', '10px ' + margin + 'px');
    });
   },500);
  }


  function mesaureMargin(maxElements, maxWidth, elWidth)
  {
   var w = maxElements * elWidth;
   var margin = ((maxWidth - w) / maxElements) / 2;
   return margin;
  }

  function openOne(_event) {
   var skip = true;
   var timeout = false;
   if ($(_event.currentTarget).parent().hasClass('menuHover')) {
    skip = false;
   }
   $('.menuItem').each(function () {
    if ($(this).hasClass('menuHover')) timeout = true;
   });

   closeAll();
   
   if (skip) {
    if (timeout)
     setTimeout(function () { openOneItem(_event); }, 1000);
    else
     openOneItem(_event);
    }
   
  }

  function openOneItem(_event) {
   $(_event.currentTarget).parent().toggleClass('menuHover');
   $(_event.currentTarget).addClass('menuItemActive');
  }
 

  function closeAll() {
   $('#menu .menuItem').removeClass('menuHover');
   $('#menu span').removeClass('menuItemActive');
  }

  function setOne(_event) {
   $('.menuSubLevel li').removeClass('menuItemActive');
   $(_event.currentTarget).addClass('menuItemActive');
  }

 </script>

</body>
</html>
